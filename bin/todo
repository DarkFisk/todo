#!/usr/bin/env node

/**
 * External dependencies.
 */

var argv = require('argvee')();

/**
 * Internal dependencies.
 */

var Storage = require('../lib/storage');
var Todos = require('../lib/todos');

/**
 * Todos.
 */

var todos = new Todos(new Storage('/tmp/todos.txt'));

/**
 * Catch all errors and print them in a nice-ish way.
 *
 * Print the stack when invoked with --debug
 */

process.on('uncaughtException', function(err) {
  if (~argv.modes.indexOf('debug') && err.stack) {
    console.error(err.stack);
  } else {
    console.error('todo: ' + err.message);
  }

  process.exit(1);
});

/**
 * Requested command.
 */

var command = argv.commands.shift() || 'help';

try {
  require('../lib/cli/' + command)(argv, todos);
} catch(e) {
  if ('MODULE_NOT_FOUND' !== e.code) throw e;
  throw new Error('Unrecognized command "' + command + '"');
}
